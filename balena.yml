type: service-source@1.0.0
name: Transformer template
version: 1.4.5
data:
  platforms:
    linux/amd64: {}
  $transformer:
    baseSlug: template-amd64
    # duplicating here because the old version of this transformer was missing the transformer secret
    encryptedSecrets:
      buildSecrets:
        NPM_TOKEN: >-
          WjdzolKFfsMp0xMxPOEpZizVEFPjKj6nwHzecYlVupHN13JT033Iz6FR4NgUUAkT7W6DHVM+pWPGCQi0hfd/KM5D5bdJLvLYNsTRAC7LUQancYIXy8Zt3BDR6JNeoRVCU8dGjnOX1wflcXgeP/4a9SMuuh5MD3lFzWuW8DYMKDcAchv9hNg5ZXp6ofwsA/QQ589fyrG7FtjozWRL/iBR9nsdh4lvWq3jZvJv1gl215HCMI+oeW6sP9VSBElq/QzH63Nscup+JbsEkTjIzh75s41Jhf0JwKT+1IL/Qcs7jTLwMZ4XEsHArSHD1imZtcj+FvPTebGpH2Tp8zEwVar0jQ==
  fragment:
    type: transformer@1.0.0
    data:
      # TODO: think about moving this into an NPM install transformer
      encryptedSecrets:
        buildSecrets:
          NPM_TOKEN: >-
            WjdzolKFfsMp0xMxPOEpZizVEFPjKj6nwHzecYlVupHN13JT033Iz6FR4NgUUAkT7W6DHVM+pWPGCQi0hfd/KM5D5bdJLvLYNsTRAC7LUQancYIXy8Zt3BDR6JNeoRVCU8dGjnOX1wflcXgeP/4a9SMuuh5MD3lFzWuW8DYMKDcAchv9hNg5ZXp6ofwsA/QQ589fyrG7FtjozWRL/iBR9nsdh4lvWq3jZvJv1gl215HCMI+oeW6sP9VSBElq/QzH63Nscup+JbsEkTjIzh75s41Jhf0JwKT+1IL/Qcs7jTLwMZ4XEsHArSHD1imZtcj+FvPTebGpH2Tp8zEwVar0jQ==
      targetPlatform: linux/amd64
      backflowMapping:
        - upstreamPath:
            $$formula: CONCATENATE("data.platforms['", this.downstream.data.platform,
              "'].image")
          downstreamValue:
            $$formula: 'CONCATENATE(this.downstream.slug, ":", this.downstream.version)'
      inputFilter:
        type: object
        required:
          - type
          - data
        properties:
          type:
            const: service-source@1.0.0
          version:
            pattern: ^[^+]*- # only run on draft versions
          data:
            type: object
            required:
              - platforms
            properties:
              platforms:
                type: object
                required:
                  - linux/amd64
      requirements: {}
      workerFilter:
        type: object
        required:
          - type
        properties:
          type:
            const: transformer-worker@1.0.0
